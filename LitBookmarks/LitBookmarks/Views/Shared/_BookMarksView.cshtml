@using Microsoft.AspNet.Identity
@model List<LitBookmarks.Models.BookmarkViewModel>

<link href="~/Styles/bootstrap.css" rel="stylesheet" />
<head>
    <style>
        .owner-hover:hover {
            color: gray;
        }

        #normal-button {
            display: inline-flex;
        }

        .btn-info {
            margin-right: 10px !important;
        }

        textarea {
            margin: 0px;
            width: 463px;
            height: 70px;
            resize: none;
            border-radius: 5px;
        }
    </style>
</head>
<link href="~/Styles/w3.css" rel="stylesheet" />
<link href="~/Styles/searchStyles.css" rel="stylesheet" />

@if (!ViewContext.RouteData.Values.ContainsKey("id"))
{
    <form method="get" action="@Url.Action(ViewContext.RouteData.Values["action"].ToString(), ViewContext.RouteData.Values["controller"].ToString())">
        @Html.TextBox("searchText", "", new { @class = "search-field", placeholder = "Type search text here...", @value = "" })
        <div class="submit-container">

            <input type="submit" class="submit" value="">
        </div>
    </form>

    <br />
    <br />
}

<body>
    @if (Model.Count == 0)
    {
        <h2>There are no such :(</h2>
    }

    @foreach (var bookmark in Model)
    {
        <div class="w3-card-4 w3-round-large" style="width: 70%; min-width: 500px;">
            <div class="w3-container w3-sand" style="background-color: #eedcb1 !important; border-radius: 5px 5px 0px 0px ">
                <h3><strong>@bookmark.Name</strong></h3>
            </div>
            <div class="w3-container">

                <div style="display: block; ">

                    @if (bookmark.BookmarkOwner.Id == User.Identity.GetUserId())
                    {
                        using (Html.BeginForm("Delete", "Bookmark", new { id = bookmark.BookmarkId }, FormMethod.Post))
                        {
                            <button style="margin-top: 1%; float: right" type="submit" id="id" class="btn btn-default btn-sm" onclick="return confirm('Are you sure you wish to delete this bookmark?');">
                                <span class="glyphicon glyphicon-remove"></span>
                            </button>
                        }

                        using (Html.BeginForm("EditView", "Bookmark", new { id = bookmark.BookmarkId }))
                        {
                            <button style="margin-top: 1%; margin-right: 1%; float: right" type="submit" id="id" class="btn btn-default btn-sm"><span class="glyphicon glyphicon-pencil"></span></button>
                        }
                    }
                </div>


                <p style="font-size: 200% !important; font-size: large;  margin: 0 !important"><strong>Book:</strong> @bookmark.Book</p>
                <p style="font-size: 200% !important; font-size: large;  margin: 0 !important"><b>Author:</b> @bookmark.Author</p>
                <p style="font-style: italic !important; margin: 0 !important"><h3>Bookmark owner: <strong class="owner-hover">
                    @Html.ActionLink(bookmark.BookmarkOwner.UserName, "ShowAnotherUserProfile", "Profile", bookmark.BookmarkOwner, 
                   new {style = "text-decoration: none"})
                </strong></h3></p>
                <p style="font-style: italic !important; margin: 0 !important">Description: @bookmark.Description</p>
                <p style="font-style: italic !important; margin: 0 !important">Date: @bookmark.Date</p>

                @if (bookmark.IsLiked)
                {
                    <button class="btn btn-default btn-sm">
                        <span class="glyphicon glyphicon-heart"></span>
                        @Html.ActionLink("Unlike " + bookmark.AmountOfLikes, "Unlike", "Like", bookmark, new { style = "text-decoration: none" })
                    </button>
                }
                else
                {
                    <button class="btn btn-default btn-sm">
                        <span class="glyphicon glyphicon-heart-empty"></span>
                        @Html.ActionLink("Like " + bookmark.AmountOfLikes, "Like", "Like", bookmark, new { style = "text-decoration: none" })
                    </button>
                }

                <button class="btn btn-default btn-sm">
                    <span class="glyphicon glyphicon-comment"></span>
                    @Html.ActionLink("Comment", "ShowCommentField", "Comment", new { bookmarkId = bookmark.BookmarkId }, new { style = "text-decoration: none" })
                </button>


            </div>

            @foreach (var comment in bookmark.Comments)
            {

                <div class="w3-container">


                    <div style="display: block;">



                        @if (comment.Author.Id == User.Identity.GetUserId() || bookmark.BookmarkOwner.Id == User.Identity.GetUserId())
                        {
                            using (Html.BeginForm("DeleteComment", "Comment", new { id = comment.CommentId }, FormMethod.Post))
                            {
                                <button style="margin-top: -0.5%; float: right" type="submit" id="id" class="btn btn-default btn-sm" onclick="return confirm('Are you sure you wish to delete this comment');">
                                    <span class="glyphicon glyphicon-remove"></span>
                                </button>
                            }
                        }
                        @if (comment.Author.Id == User.Identity.GetUserId())
                        {
                            using (Html.BeginForm("ShowEditCommentField", "Comment", new { id = comment.CommentId }))
                            {
                                <button style="margin-top: -0.5%; float: right" type="submit" id="id" class="btn btn-default btn-sm"><span class="glyphicon glyphicon-pencil"></span></button>
                            }
                        }


                    </div>

                    @if (TempData["commentEditField" + comment.CommentId] == null)
                    {
                        <p>
                            <strong>@comment.Author.UserName:</strong> @comment.Text
                        </p>

                    }
                    else
                    {                    
                            <div class="w3-container">
                               
                                <form action="/Comment/SaveEditedComment" method="post" autocomplete="on">
                                    @Html.Hidden("commentId", comment.CommentId)
                                    @Html.TextArea("text", TempData["commentEditField" + comment.CommentId].ToString())
                                    <br />

                                    <div id="normal-button">
                                        <input type="submit" value="Save" class="btn btn-info">
                                        @Html.ActionLink("Cancel", "Cancel", "Comment", null, new { @class = "btn btn-default" })
                                    </div>
                                </form>
                        </div>
                    }

                </div>
            }

            @if (TempData["commentField" + bookmark.BookmarkId] != null)
            {
                <div class="w3-container">
                    <form action="/Comment/AddComment" method="post" autocomplete="on">
                        @Html.Hidden("bookmark", bookmark.BookmarkId)
                        @Html.TextArea("text", "")
                        <br />
                        <div id="normal-button">
                            <input type="submit" value="Add" class="btn btn-info">
                            @Html.ActionLink("Cancel", "Cancel", "Comment", null, new { @class = "btn btn-default" })
                        </div>
                    </form>
                </div>

            }




            <br />
        </div>
    }

</body>

